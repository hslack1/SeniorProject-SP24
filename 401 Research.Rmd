---
title: "401 Research"
author: "Holston Slack"
date: "2/29/2024"
output: html_document
---
```{r}
library (readr)
library(dplyr)
library(ggplot2)
library(stringr)
library(data.table)
library(tidyverse)
```

```{r}
credits <- read.csv("credits.csv")
keywords <- read.csv("keywords.csv")
ratings <- read.csv ("ratings.csv")
links <- read.csv("links.csv")
meta <- read.csv("movies_metadata.csv")

```

```{r}
#merges 2 datasets and joins based off common column
df_combined <- merge(ratings, links, by = "movieId")
```


```{r}
meta <- read.csv("movies_metadata.csv")
meta <- meta %>%
  filter(original_language == "en") %>% 
  filter(as.numeric(str_sub(release_date, 1, 4)) >= 1970 & 
         as.numeric(str_sub(release_date, 1, 4)) <= 2020)%>%
  filter(revenue >= 100) %>%
  filter(budget >=100)

nonsequels <- meta %>%
  filter(is.na(meta$belongs_to_collection) | nchar(meta$belongs_to_collection) == 0) 

sequels <- meta %>%
  filter(str_detect(belongs_to_collection, "\\{"))

sequels <- sequels %>% 
  rename(tmdbId = id)

```

```{r}
df_combined <- merge(df_combined, meta, by = "tmdbId")
#combine datasets again, this time with a different column
```



```{r}
df_combined <- df_combined %>%
  filter(original_language == "en") %>% 
  filter(as.numeric(str_sub(release_date, 1, 4)) >= 1970 & 
         as.numeric(str_sub(release_date, 1, 4)) <= 2020)
```



```{r}
df_combined <- df_combined[, !(colnames(df_combined) %in% c("timestamp", "adult", "homepage", "poster_path", "spoken_languages", "status", "tagline", "video", "imdb_id", "overview"))]

#drop columns that we won't be using in analysis

meta <- meta[, !(colnames(meta) %in% c("timestamp", "adult", "homepage", "poster_path", "spoken_languages", "status", "tagline", "video", "imdb_id", "overview"))]
```


Working to regex the title from belongs_to column; string; incomplete

```{r}
extract_between_commas <- function(text) {
  # Split the text by commas using str_split
  split_text <- str_split(text, ",")[[1]]  # Split text, take the first element (vector of substrings)
  
  # Check if there are at least 3 commas (ensure enough elements for 2nd and 3rd comma)
  if (length(split_text) >= 3) {
    # Return the text between 2nd and 3rd comma (excluding commas)
    return(split_text[2])
  } else {
    # If there are less than 3 commas, return an empty string
    return("")
  }
}

# Apply the function to the "text_column"
sequels$franchise <- lapply(sequels$belongs_to_collection, extract_between_commas)


```

```{r}
# Function to extract text between 3rd and 4th apostrophes
extract_between_apostrophes <- function(text) {
  # Split the text by apostrophes using str_split
  split_text <- str_split(text, "'")[[1]]  # Split text, take the first element (vector of substrings)
  
  # Check if there are at least 4 apostrophes (ensure enough elements for 3rd and 4th)
  if (length(split_text) >= 5) {
    # Extract the text between 3rd and 4th apostrophe (excluding apostrophes)
    extracted_text <- split_text[4]
    
    # Remove "collection" (case-insensitive) if it exists at the end
    extracted_text <- str_trim(extracted_text, side = "right")  # Remove trailing whitespace
    extracted_text <- gsub(" collection$", "", extracted_text, ignore.case = TRUE)  # Remove " collection" at the end (case-insensitive)
    
    return(extracted_text)
  } else {
    # If there are less than 4 apostrophes, return an empty string
    return("")
  }
}

# Apply the function to the "text_column"
sequels$belongs_to_collection <- lapply(sequels$franchise, extract_between_apostrophes)

sequels <- sequels[, !(colnames(sequels) %in% c("timestamp","lanchise","franchise", "collection"))]
```

